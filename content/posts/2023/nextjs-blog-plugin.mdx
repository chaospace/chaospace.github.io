---
title: Next.js ë¸”ë¡œê·¸ ì œì‘( MDX serialize )
subtitle: 
date: 2023-08-06
tags: [markdown, remark, rehype]
draft: false
summary: remark, rehypeì„ ì´ìš©í•œ markdown ê°€ê³µ
---

mdxíŒŒì¼ ë³€í™˜ ì‹œ remarkì™€ rehypeí”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ë©° ì•Œê²Œëœ ë‚´ìš©ì„ ì •ë¦¬í•œë‹¤.

## ê°œìš”
- [unified](https://github.com/unifiedjs/unified) êµ¬ë¬¸íŠ¸ë¦¬(syntax tree)ë¡œ ì»¨í…ì¸ ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤  
500ê°œ ì´ìƒì˜ í”„ë¦¬ ì˜¤í”ˆì†ŒìŠ¤ íŒ¨í‚¤ì§€ ëª¨ìŒ  
ê´€ë ¨ í”ŒëŸ¬ê·¸ì¸ì— remark, rehype í¬í•¨

```ascii
| ........................ process ........................... |
| .......... parse ... | ... run ... | ... stringify ..........|

          +--------+                     +----------+
Input ->- | Parser | ->- Syntax Tree ->- | Compiler | ->- Output
          +--------+          |          +----------+
                              X
                              |
                       +--------------+
                       | Transformers |
                       +--------------+ 
```

- [remark](https://github.com/remarkjs/remark) :
  ë§ˆí¬ë‹¤ìš´ êµ¬ë¶„ë¶„ì„[^1]ê³¼ ì§ë ¬í™”[^2] ì²˜ë¦¬ë„êµ¬
- [rehype](https://github.com/rehypejs) : HTMLì„ ê²€ì‚¬í•˜ê³  ë³€í™˜í•  ìˆ˜ ìˆëŠ” ë„êµ¬


## ì£¼ìš” í”ŒëŸ¬ê·¸ì¸

mdxíŒŒì¼ <code>serialize</code>ì‹œ ì‚¬ìš©í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ë‹¤ì–‘í•˜ê²Œ ì œê³µë˜ë©° ì‚¬ìš©í•œ ê²ƒë§Œ ì •ë¦¬í•œë‹¤.

### remark-toc-headings 
    í—¤ë”ìš”ì†Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ Table of Contents ì¶”ì¶œ ì˜¤í”ˆì†ŒìŠ¤ë„ ì œê³µë˜ì§€ë§Œ ì ìš©ì´ ì• ë§¤í•´ ì§ì ‘êµ¬í˜„  
```typescript 
import { slug } from "github-slugger";
import { toString } from "mdast-util-to-string";
import { visit } from "unist-util-visit";

function remarkTocHeadings(options: any) {
    return (tree: any) => visit(tree, 'heading', (node, index, parent) => {
        const textContent = toString(node);
        options.exportRef.push({
            value: textContent,
            url: `#${slug(textContent)}`,
            depth: node.depth
        })
    });
}
```

### remark-gfm
    
    githubë§ˆí¬ë‹¤ìš´ í˜•ì‹ footnotes<code>([^4])</code>, tables<code>(|cell|...)</code>, strikethrough<code>(\~\~stuff\~\~)</code>, tasklists<code>(* [x])</code>ë“±ì„ ì§€ì›  
    [link](https://github.com/remarkjs/remark-gfm)


### remark-code-titles  
    syntaxhighlightingì— íŒŒì¼ëª… í‘œì‹œ ê¸°ëŠ¥ ì œê³µ  
    es6ëª¨ë“ˆì€ ì œê³µë˜ì§€ ì•Šì•„ ì§ì ‘ êµ¬í˜„.

```javascript:remark-code-titles.ts
import { visit } from "unist-util-visit";

function remarkCodeTitles() {
  return (tree: any) =>
    visit(tree, "code", (node, index, parent) => {
      const nodeLang = node.lang || "";
      let language = "";
      let title = "";
      if (nodeLang.includes(":")) {
        language = nodeLang.slice(0, nodeLang.search(":"));
        title = nodeLang.slice(nodeLang.search(":") + 1, nodeLang.length);
      }
      if (!title) {
        return;
      }

      const className = "remark-code-title";

      const titleNode = {
        type: "mdxJsxFlowElement",
        name: "div",
        attributes: [
          { type: "mdxJsxAttribute", name: "className", value: className },
        ],
        children: [{ type: "text", value: title }],
        data: { _xdmExplicitJsx: true },
      };
      parent.children.splice(index, 0, titleNode);
      node.lang = language;
    });
}

export default remarkCodeTitles;

```

### rehype-slug  
    í—¤ë”ìš”ì†Œì— í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ idì†ì„± ì¶”ê°€  
    [link](https://github.com/rehypejs/rehype-slug)  

```html 
//input
<h1 id=some-id>Lorem ipsum</h1>
<h2>Dolor sit amet ğŸ˜ª</h2>
<h3>consectetur &amp; adipisicing</h3>
<h4>elit</h4>
<h5>elit</h5>

//output
<h1 id="some-id">Lorem ipsum</h1>
<h2 id="dolor-sit-amet-">Dolor sit amet ğŸ˜ª</h2>
<h3 id="consectetur--adipisicing">consectetur &#x26; adipisicing</h3>
<h4 id="elit">elit</h4>
<h5 id="elit-1">elit</h5>
```
### rehype-prism-plus
    syntaxhighlightingê¸°ëŠ¥ ì œê³µ  
    [link](https://github.com/timlrx/rehype-prism-plus)

### rehype-autolink-headings 
    rehype-slugì™€ í•˜ëŠ” ì—­í• ì€ ë¹„ìŠ·í•œë° ìƒì„±ë˜ëŠ” anchorìœ„ì¹˜ë¥¼ ì¡°ì •ê°€ëŠ¥  
    [link](https://github.com/rehypejs/rehype-autolink-headings)

```html 
//input
<h1 id=some-id>Lorem ipsum</h1>
<h2>Dolor sit amet ğŸ˜ª</h2>
<h3>consectetur &amp; adipisicing</h3>
<h4>elit</h4>
<h5>elit</h5>

//output
<h1 id="some-id">
  <a aria-hidden="true" tabindex="-1" href="#some-id">
    <span class="icon icon-link"></span></a>
  Lorem ipsum
</h1>
<h2 id="dolor-sit-amet-">
  <a aria-hidden="true" tabindex="-1" href="#dolor-sit-amet-">
    <span class="icon icon-link"></span></a>
  Dolor sit amet ğŸ˜ª
</h2>
<h3 id="consectetur--adipisicing">
  <a aria-hidden="true" tabindex="-1" href="#consectetur--adipisicing">
    <span class="icon icon-link"></span></a>
  consectetur &#x26; adipisicing
</h3>
<h4 id="elit">
  <a aria-hidden="true" tabindex="-1" href="#elit">
    <span class="icon icon-link"></span></a>
    elit
</h4>
<h5 id="elit-1">
  <a aria-hidden="true" tabindex="-1" href="#elit-1">
    <span class="icon icon-link"></span>
  </a>
  elit
</h5>
```

```typescript
//ì ìš© ì‹œ ì˜µì…˜ ê°’ì„ í†µí•´ ì¶”ê°€ ì†ì„± ì ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.
[rehypeAutoLinkHeadings, { properties: { className: ['anchor']}}]
```

---
[^1]: parsing : ë¬¸ì„œì˜ ë‚´ìš©ì„ í† í°ìœ¼ë¡œ ë¶„ì„í•˜ê³ , ë¬¸ë²•ì  ì˜ë¯¸ì™€ êµ¬ì¡°ë¥¼ ë°˜ì˜í•œ parse treeë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì • 
[^2]: serializing : ë°ì´í„° êµ¬ì¡°ë‚˜ ê°ì²´ë¥¼ ë‹¤ë¥¸ ì»´í“¨í„° í™˜ê²½ì— ì €ì¥(ì´ë¥¼í…Œë©´ íŒŒì¼ì´ë‚˜ ë©”ëª¨ë¦¬ ë²„í¼ì—ì„œ, ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë§í¬ ê°„ ì „ì†¡)í•˜ê³  ë‚˜ì¤‘ì— ì¬êµ¬ì„±í•  ìˆ˜ ìˆëŠ” í¬ë§·ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •.
